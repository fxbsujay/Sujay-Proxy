import{P as B,m as V,a as L,b as J,d as E,s as M,e as S}from"./index-6a5292e1.js";import{d as z,k as Y,r as _,a as G,b as p,o as w,l as K,w as o,n as Q,m as k,f as n,q as h,u as v,s as W,t as X,j as Z,c as $,e as T,F as D,P as ee,i as q,v as te}from"./index-a7ff644a.js";const ae=[{title:"服务端口",dataIndex:"serverPort",align:"center"},{title:"代理客户端",dataIndex:"clientIp",align:"center"},{title:"代理端口",dataIndex:"clientPort",align:"center"},{title:"运行状态",dataIndex:"binding",align:"center",customRender:({text:y})=>y?"启动中":"未启动"},{title:"访客通道",dataIndex:"state",align:"center",customRender:({text:y})=>{var e;return(e=B.find(t=>t.value===y))==null?void 0:e.label}},{title:"协议",dataIndex:"protocol",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}],F={clientIp:"localhost",clientPort:3306,protocol:"HTTP",serverPort:3306,state:"READY"},ne={clientIp:[{required:!0,trigger:"change",message:"请输入代理客户端Ip"}],clientPort:[{required:!0,trigger:"change",message:"请输入代理客户端端口"}],serverPort:[{required:!0,trigger:"change",message:"请输入服务端端口"}],protocol:[{required:!0,trigger:"change",message:"请输入协议"}]};class R{static IsArray(e){return this.IsObject(e)&&e instanceof Array}static IsObject(e){return e&&typeof e=="object"}static JsonClone(e){return JSON.parse(JSON.stringify(e))}static DeepClone(e,t){this.IsArray(e)?t=t||[]:t=t||{};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(typeof e[a]=="object"&&e[a]!==null?(t[a]=this.IsArray(e[a])?[]:{},this.DeepClone(e[a],t[a])):t[a]=e[a]);return t}static UnCoverSimpleClone(e,t){this.IsArray(e)?t=t||[]:t=t||{};for(const a in t)Object.prototype.hasOwnProperty.call(e,a)?t[a]=e[a]:delete t[a];return t}static SimpleClone(e,t){this.IsArray(e)?t=t||[]:t=t||{};for(const a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}}const le=z({__name:"edit",setup(y,{expose:e}){const t=Y.useForm,a={labelCol:{span:7},wrapperCol:{span:24}},s=_(!1),r=_(!1),g=_(!1),l=_(R.DeepClone(F,{})),{resetFields:i,validate:d,validateInfos:b,clearValidate:m}=t(l,ne);let f=G(null);const O=()=>{d().then(()=>{r.value=!0,V(l.value).then(()=>{I()}).catch(()=>r.value=!1)})},P=A=>{f=A,R.DeepClone(R.DeepClone(F,{}),l),i(),g.value=!1,s.value=!0,Q(()=>m())},C=()=>{r.value=!1,s.value=!1,m()};function I(){C(),k.success({message:"端口映射成功",description:`localhost:${l.value.serverPort} -> ${l.value.clientIp}:${l.value.clientPort}`}),f&&f()}return e({init:P}),(A,u)=>{const U=p("a-input"),x=p("a-form-item"),j=p("a-select"),H=p("a-form"),N=p("a-modal");return w(),K(N,{class:"basic-form",open:s.value,"onUpdate:open":u[4]||(u[4]=c=>s.value=c),maskClosable:!1,title:g.value?"修改":"新建",width:500,centered:!0,"confirm-loading":r.value,onCancel:C,onOk:O},{default:o(()=>[n(H,W(X(a)),{default:o(()=>[n(x,h({label:"服务端端口"},v(b).serverPort),{default:o(()=>[n(U,{disabled:r.value,value:l.value.serverPort,"onUpdate:value":u[0]||(u[0]=c=>l.value.serverPort=c)},null,8,["disabled","value"])]),_:1},16),n(x,h({label:"代理客户端IP"},v(b).clientIp),{default:o(()=>[n(U,{disabled:r.value,value:l.value.clientIp,"onUpdate:value":u[1]||(u[1]=c=>l.value.clientIp=c)},null,8,["disabled","value"])]),_:1},16),n(x,h({label:"代理客户端端口"},v(b).clientPort),{default:o(()=>[n(U,{disabled:r.value,value:l.value.clientPort,"onUpdate:value":u[2]||(u[2]=c=>l.value.clientPort=c)},null,8,["disabled","value"])]),_:1},16),n(x,h({label:"协议"},v(b).protocol),{default:o(()=>[n(j,{disabled:r.value,value:l.value.protocol,"onUpdate:value":u[3]||(u[3]=c=>l.value.protocol=c),options:v(L)},null,8,["disabled","value","options"])]),_:1},16)]),_:1},16)]),_:1},8,["open","title","confirm-loading"])}}}),oe={class:"wrapper"},ie=z({__name:"index",setup(y){const e=_(),t=_({port:""}),a=_([]),s=()=>{J(t.value).then(i=>{a.value=i})};Z(()=>s());const r=()=>{e.value.init(s)},g=i=>{E(i.serverPort).then(()=>{s(),k.success({message:"删除代理成功",description:`localhost:${i.serverPort}`})})},l=(i,d)=>{d?M({port:i.serverPort}).then(()=>{s(),k.success({message:"代理服务已重启",description:"重启为异步任务，请稍后刷新列表查看运行状态"})}):S({port:i.serverPort}).then(()=>{s(),k.success({message:"代理服义器已关闭"})})};return(i,d)=>{const b=p("a-input-search"),m=p("a-button"),f=p("a-popconfirm"),O=p("a-table");return w(),$(D,null,[T("div",oe,[n(b,{value:t.value.port,"onUpdate:value":d[0]||(d[0]=P=>t.value.port=P),placeholder:"代理端口","enter-button":"",style:{width:"300px"},size:"large",onSearch:s},null,8,["value"]),n(m,{style:{float:"right","margin-right":"10px"},type:"primary",size:"large",onClick:d[1]||(d[1]=P=>r())},{icon:o(()=>[n(v(ee),{style:{"font-size":"20px"}})]),_:1})]),n(O,{bordered:"","data-source":a.value,columns:v(ae),pagination:!1},{bodyCell:o(({column:P,record:C})=>[P.dataIndex==="operation"?(w(),$(D,{key:0},[n(f,{title:"你确定要删除代理吗",onConfirm:I=>g(C)},{default:o(()=>[n(m,{danger:"",type:"link",size:"middle"},{default:o(()=>[q(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"]),n(f,{title:"你确定要重启吗",onConfirm:I=>l(C,!0)},{default:o(()=>[n(m,{type:"link",size:"middle"},{default:o(()=>[q(" 重启 ")]),_:1})]),_:2},1032,["onConfirm"]),n(f,{title:"你确定要关闭吗",onConfirm:I=>l(C,!1)},{default:o(()=>[n(m,{type:"link",size:"middle"},{default:o(()=>[q(" 关闭 ")]),_:1})]),_:2},1032,["onConfirm"])],64)):te("",!0)]),_:1},8,["data-source","columns"]),n(le,{ref_key:"addOrUpdateRef",ref:e},null,512)],64)}}});export{ie as default};
